---
title: "PracTools Project"
date: "3/22/2024"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
header-includes:
- \usepackage{bbm}
- \usepackage{setspace}
- \singlespacing
number_sections: yes
fontsize: 12pt
---
  
  
```{r setup, include=FALSE, tidy=TRUE}
knitr::opts_chunk$set(echo = TRUE,cache=TRUE, 
                      autodep=TRUE, cache.comments=FALSE,
                      message=FALSE, warning=FALSE)

```



```{r, echo=FALSE}
library(ggplot2)  
library(tidyverse)
library(dplyr)
library(glue)
library(tigris)
library(sf)
library(leaflet)
library(tidycensus)
library(readxl)
options(tigris_class = "sf")
options(tigris_use_cache = T)
set.seed(-1234)
```


```{r}
library(readxl)
data <- read_excel("PrinceGeorgeMD.xlsx", sheet=2)
```


```{r}
view(data)
```


```{r}
head(data)
```


```{r, eval=FALSE}
data <- data %>%
  arrange(BlockGroup) %>%
  mutate(Tract = substr(BlockGroup, 1, nchar(BlockGroup) - 1),
         BlockGroupID = as.numeric(substr(BlockGroup, nchar(BlockGroup), nchar(BlockGroup))))
```


### Filter out tracts with only 1 block group 

```{r, eval=FALSE}
tract_counts <- data %>%
  group_by(Tract) %>%
  summarize(Count = n()) %>%
  filter(Count == 1) %>%
  ungroup()

single_block_groups <- data %>%
  inner_join(tract_counts, by = "Tract")

single_block_groups
```


```{r}
data <- read_excel("PrinceGeorgeMD_modified.xlsx", sheet=2) 

data <- data %>% 
  na.omit() %>%
  mutate(Tract = substr(BlockGroup, 1, nchar(BlockGroup) - 1))

```

```{r}
bg_data <- data %>% 
  group_by(BlockGroup) %>%
  mutate(y18 = sum(Male18to19Yrs, Male20Yrs, Male21Yrs, Male22to24Yrs, Male25to29Yrs, Male30to34Yrs, Male35to39Yrs, Male40to44Yrs, Female18to19Yrs, Female20Yrs, Female21Yrs, Female22to24Yrs, Female25to29Yrs, Female30to34Yrs, Female35to39Yrs, Female40to44Yrs),
         y45 = sum(Male45to49Yrs, Male50to54Yrs, Male55to59Yrs, Male60to61Yrs, Male62to64Yrs, Female45to49Yrs, Female50to54Yrs, Female55to59Yrs, Female60to61Yrs, Female62to64Yrs),
         y65 = sum(Male65to66Yrs, Male67to69Yrs, Male70to74Yrs, Male75to79Yrs, Male80to84Yrs, MaleGE85Yrs, Female65to66Yrs, Female67to69Yrs, Female70to74Yrs, Female75to79Yrs, Female80to84Yrs, FemaleGE85Yrs)) %>% 
  select(BlockGroup, y18, y45, y65)

bg_data
```


```{r}
bg_data
```


```{r}
# Get domain population by tracts
tract_data <- data %>% 
  group_by(Tract) %>%
  mutate(y18 = sum(Male18to19Yrs, Male20Yrs, Male21Yrs, Male22to24Yrs, Male25to29Yrs, Male30to34Yrs, Male35to39Yrs, Male40to44Yrs, Female18to19Yrs, Female20Yrs, Female21Yrs, Female22to24Yrs, Female25to29Yrs, Female30to34Yrs, Female35to39Yrs, Female40to44Yrs),
         y45 = sum(Male45to49Yrs, Male50to54Yrs, Male55to59Yrs, Male60to61Yrs, Male62to64Yrs, Female45to49Yrs, Female50to54Yrs, Female55to59Yrs, Female60to61Yrs, Female62to64Yrs),
         y65 = sum(Male65to66Yrs, Male67to69Yrs, Male70to74Yrs, Male75to79Yrs, Male80to84Yrs, MaleGE85Yrs, Female65to66Yrs, Female67to69Yrs, Female70to74Yrs, Female75to79Yrs, Female80to84Yrs, FemaleGE85Yrs)) %>% 
  select(Tract, y18, y45, y65) %>%
  unique()

tract_data
```

```{r}
m <- 15 
target <- data.frame(Age_Group= c("18-44", "45-64", "65+"), 
                 n = c(100, 100, 100), 
                 RR = c(0.6, 0.7, 0.85))

target$n_weighted <- target$n / target$RR
target$n_weighted

n_weighted <- sum(target$n_weighted)
q_avg <- n_weighted/m
q_avg
```


```{r}
N_1 <- sum(tract_data$y18)
N_2 <- sum(tract_data$y45)
N_3 <- sum(tract_data$y65)

target <- target %>%
  mutate(N_d = c(N_1, N_2, N_3),
         f_d = n_weighted / N_d)

target$f_d*100 # f_d ()
```




